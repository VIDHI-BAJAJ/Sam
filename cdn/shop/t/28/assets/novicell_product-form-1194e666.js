import{f as d}from"./theme-f6a932f0.js";customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.querySelector("[name=id]").disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.querySelector('[type="submit"]')&&document.querySelector("cart-drawer")&&this.querySelector('[type="submit"]').setAttribute("aria-haspopup","dialog")}onSubmitHandler(s){s.preventDefault();const a=JSON.parse(document.querySelector("[data-product-json]").innerHTML).product.type.toLowerCase();d().then(o=>{if(o.swatchProductsLimitReached[0]&&a==window.swatches.productTypeUpholstery||o.swatchProductsLimitReached[0]&&a==window.swatches.productTypeMaterial){let r=new Event("click");const t=document.querySelector('[data-modal="#PopupModal-Samples"]'),e=document.querySelector("[data-stock-modal][open]");e&&e.removeAttribute("open"),t.querySelector("button").dispatchEvent(r)}else{if(this.querySelector('[type="submit"]').getAttribute("aria-disabled")==="true")return;this.handleErrorMessage(),this.querySelector('[type="submit"]').setAttribute("aria-disabled",!0),this.querySelector('[type="submit"]').classList.add("loading"),this.querySelector(".loading-overlay__spinner").classList.remove("hidden");const r=fetchConfig("javascript");r.headers["X-Requested-With"]="XMLHttpRequest",delete r.headers["Content-Type"];const t=new FormData(this.form);this.cart&&(t.append("sections",this.cart.getSectionsToRender().map(e=>e.id)),t.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),r.body=t,fetch(`${routes.cart_add_url}`,r).then(e=>e.json()).then(e=>{if(this.addBuyXGetYProductToCart(e.id),e.status){this.handleErrorMessage(e.description);const n=this.querySelector('[type="submit"]').querySelector(".sold-out-message");if(!n)return;this.querySelector('[type="submit"]').setAttribute("aria-disabled",!0),this.querySelector('[type="submit"]').querySelector("span").classList.add("hidden"),n.classList.remove("hidden"),this.error=!0;return}else if(!this.cart){window.location=window.routes.cart_url;return}this.error||publish(PUB_SUB_EVENTS.cartUpdate,{source:"product-form"}),this.error=!1;const c=this.closest("quick-add-modal")||this.querySelector("[data-stock-modal]");c?(document.body.addEventListener("modalClosed",()=>{setTimeout(()=>{this.cart.renderContents(e)})},{once:!0}),c.hide(!0)):this.cart.renderContents(e)}).catch(e=>{console.error(e)}).finally(()=>{this.querySelector('[type="submit"]').classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||this.querySelector('[type="submit"]').removeAttribute("aria-disabled"),this.querySelector(".loading-overlay__spinner").classList.add("hidden")})}}).catch(o=>{console.error(o)})}handleErrorMessage(s=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!s),s&&(this.errorMessage.textContent=s))}addBuyXGetYProductToCart(s){const i=JSON.parse(document.querySelector("[data-product-json]").innerHTML);if(!i["buy-x-get-y"])return;let o=i.configuration.metafields["buy-x-get-y"][s].get_product;if(o>0){if(this.cart){var r={id:o,quantity:1,properties:{Campaign:"Free with the purchase of a Ingeborg Lounge chair"},sections:this.cart.getSectionsToRender().map(t=>t.id),sections_url:window.location.pathname};this.cart.setActiveElement(document.activeElement)}fetch(`${window.routes.cart_add_url}.js`,{body:JSON.stringify(r),credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},method:"POST"}).then(function(t){return t.json()}).then(t=>{this.cart.renderContents(t)}).catch(function(t){console.error(t)})}}});
//# sourceMappingURL=/cdn/shop/t/28/assets/novicell_product-form-1194e666.js.map
