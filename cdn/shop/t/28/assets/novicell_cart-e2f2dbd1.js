class p extends HTMLElement{constructor(){super(),this.addEventListener("click",e=>{e.preventDefault(),(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0)})}}customElements.define("cart-remove-button",p);class g extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const e=debounce(t=>{this.onChange(t)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",e.bind(this))}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,e=>{e.source!=="cart-items"&&this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}onChange(e){this.updateQuantity(e.target.dataset.index,e.target.value,document.activeElement.getAttribute("name"))}onCartUpdate(){fetch("/cart?section_id=main-cart-items").then(e=>e.text()).then(e=>{const s=new DOMParser().parseFromString(e,"text/html").querySelector("cart-items");this.innerHTML=s.innerHTML}).catch(e=>{console.error(e)})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(e,t,s){this.enableLoading(e);const c=JSON.stringify({line:e,quantity:t,sections:this.getSectionsToRender().map(r=>r.section),sections_url:window.location.pathname});fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:c}).then(r=>r.text()).then(r=>{const a=JSON.parse(r),d=document.getElementById(`Quantity-${e}`)||document.getElementById(`Drawer-quantity-${e}`),y=document.querySelectorAll(".cart-item");if(a.errors){d.value=d.getAttribute("value"),this.updateLiveRegions(e,a.errors);return}this.classList.toggle("is-empty",a.item_count===0);const n=document.querySelector("cart-drawer"),h=document.getElementById("main-cart-footer");h&&h.classList.toggle("is-empty",a.item_count===0),n&&n.classList.toggle("is-empty",a.item_count===0),this.getSectionsToRender().forEach(i=>{const E=document.getElementById(i.id).querySelector(i.selector)||document.getElementById(i.id);E.innerHTML=this.getSectionInnerHTML(a.sections[i.section],i.selector)});const l=a.items[e-1]?a.items[e-1].quantity:void 0;let u="";y.length===a.items.length&&l!==parseInt(d.value)&&(typeof l>"u"?u=window.cartStrings.error:u=window.cartStrings.quantityError.replace("[quantity]",l)),this.updateLiveRegions(e,u);const m=document.getElementById(`CartItem-${e}`)||document.getElementById(`CartDrawer-Item-${e}`);m&&m.querySelector(`[name="${s}"]`)?n?trapFocus(n,m.querySelector(`[name="${s}"]`)):m.querySelector(`[name="${s}"]`).focus():a.item_count===0&&n?trapFocus(n.querySelector(".drawer__inner-empty"),n.querySelector("a")):document.querySelector(".cart-item")&&n&&trapFocus(n,document.querySelector(".cart-item__name")),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items"})}).catch(()=>{this.querySelectorAll(".loading-overlay").forEach(a=>a.classList.add("hidden"));const r=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");r.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(e)})}updateLiveRegions(e,t){const s=document.getElementById(`Line-item-error-${e}`)||document.getElementById(`CartDrawer-LineItemError-${e}`);s&&(s.querySelector(".cart-item__error-text").innerHTML=t),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const c=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");c.setAttribute("aria-hidden",!1),setTimeout(()=>{c.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(e,t){return new DOMParser().parseFromString(e,"text/html").querySelector(t).innerHTML}enableLoading(e){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const s=this.querySelectorAll(`#CartItem-${e} .loading-overlay`),c=this.querySelectorAll(`#CartDrawer-Item-${e} .loading-overlay`);[...s,...c].forEach(r=>r.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(e){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const s=this.querySelectorAll(`#CartItem-${e} .loading-overlay`),c=this.querySelectorAll(`#CartDrawer-Item-${e} .loading-overlay`);s.forEach(r=>r.classList.add("hidden")),c.forEach(r=>r.classList.add("hidden"))}}customElements.define("cart-items",g),customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("change",debounce(e=>{const t=JSON.stringify({note:e.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:t})},ON_CHANGE_DEBOUNCE_TIMER))}}),customElements.get("cart-accept-terms")||customElements.define("cart-accept-terms",class extends HTMLElement{constructor(){super(),this.wrapper=this,this.checkoutButton=this.parentElement.querySelector('button[name="checkout"]')||this.parentElement.querySelector('button[type="submit"]'),this.checkbox=this.querySelector('[name="acceptTerms"]'),localStorage.getItem("terms-accepted")!==null&&localStorage.getItem("terms-accepted")!=="true"&&this.wrapper.classList.add("error"),this.checkbox.checked=localStorage.getItem("terms-accepted")==="true",this.checkoutButton&&this.checkoutButton.addEventListener("click",e=>{this.checkbox.checked||(e.preventDefault(),this.wrapper.classList.add("error"))}),this.checkbox.addEventListener("change",()=>{this.checkbox.checked?(localStorage.setItem("terms-accepted",!0),this.wrapper.classList.remove("error")):(localStorage.setItem("terms-accepted",!1),this.wrapper.classList.add("error"))})}});class I extends g{getSectionsToRender(){return[{id:"CartDrawer",section:"novicell_cart-drawer",selector:".drawer__inner"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:"#cart-icon-bubble"}]}}customElements.define("cart-drawer-items",I);
//# sourceMappingURL=/cdn/shop/t/28/assets/novicell_cart-e2f2dbd1.js.map
